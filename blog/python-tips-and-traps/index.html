<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Python Tips and Traps</title>
  <meta name="author" content="Ben Chuanlong Du">

  <link href="http://www.legendu.net/misc/atom.xml" type="application/atom+xml" rel="alternate"
        title="Ben Chuanlong Du's Blog Atom Feed" />


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="http://www.legendu.net/misc/favicon.png" rel="icon">
  <link href="http://www.legendu.net/misc/theme/css/main_2.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="http://www.legendu.net/misc/theme/js/modernizr-2.0.js"></script>
  <script src="http://www.legendu.net/misc/theme/js/ender.js"></script>
  <script src="http://www.legendu.net/misc/theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="http://www.legendu.net/misc/">Ben Chuanlong Du's Blog</a></h1>
    <h2>It is never too late to learn.</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://www.legendu.net/misc/atom.xml" rel="subscribe-rss">RSS</a></li>
</ul>

<form name="search" action="https://www.bing.com/search" method="get" onSubmit="return build_query()">
  <fieldset role="search">
      <!--
    <input type="hidden" name="q" value="site:http://www.legendu.net/misc" />
        -->
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<script type = "text/javascript">
    function build_query() {
        var query = document.forms["search"]["q"].value;
        var prefix = "site:http://www.legendu.net/misc "
        if (!query.startsWith(prefix)) {
            query = prefix + query;
            document.forms["search"]["q"].value = query;
        }
        return true;
    }
</script>

<ul class="main-navigation">
    <li><a href="http://www.legendu.net">Home</a></li>
    <li><a href="http://www.legendu.net/misc">Blog</a></li>
    <li><a href="http://www.legendu.net/misc/archives.html">Archives</a></li>
    <li><a href="http://www.legendu.net/misc/pages/links.html">Links</a></li>
</ul></nav>
  <div id="main">
    <div id="content">
<div>
  <article class="hentry" role="article">
<header>
      <h1 class="entry-title">Python Tips and Traps</h1>
      <p class="meta"><time datetime="2019-10-16T22:07:28-07:00" pubdate>Oct 16, 2019</time></p>
</header>

  <div class="entry-content"><p><strong>
Things on this page are fragmentary and immature notes/thoughts of the author.
It is not meant to readers but rather for convenient reference of the author and future improvement.
</strong></p>
<p><strong>
Things on this page are fragmentary and immature notes/thoughts of the author.
It is not meant to readers but rather for convenient reference of the author and future improvement.
</strong></p>
<h2 id="tricks-and-traps">Tricks and Traps</h2>
<p>https://docs.python-guide.org/writing/gotchas/</p>
<p>https://stackoverflow.com/questions/101268/hidden-features-of-python</p>
<ol>
<li>
<p>Use type annotation to make your code more readable and easier to understand.</p>
</li>
<li>
<p>Restrict the types of objects that your function/method can be applied to 
  and throw a (ValueError) exception when a wrong type is provided.
  This helps minimize surprisings.</p>
</li>
<li>
<p>AVOID returning objects of different types from a Python function/method.</p>
</li>
<li>
<p>Be CAREFULL about module name conflictions!
  It happens when there are more than one Python scripts with the same name on Python module search paths.
  This is often not a problem when developing Python packages due to absolute and relative import.
  However, 
  this issue can come up in a few situations and can be quite tricky for uers to figure out.
    a. If an user run a Python script whose parent directory contains a Python script with a name conflicting with other (official) Python modules,
      this issue will come up.
    b. An even trickier situation is when a Python script is piped to a Python interpreter directly. 
      According to <a href="https://docs.python.org/3/library/sys.html#sys.path">docs about sys.path</a>,
      <code>sys.path[0]</code> is initailized to be the empty string on the startup of Python in this situation 
      which directs Python to search modules in the current directly first.
      Since an user can run the command in any directory, 
      it is more likely for him/her to encounter the issue of conflicting module names. 
  If a Python script is never intended to be imported as a module, 
  one way to resolove the issue is to simply remove the first element from <code>sys.path</code>.
  <code>import sys
  sys.path.pop(0)</code></p>
</li>
<li>
<p>Almost all modern programming languages follow the convention
  of not returnting anything (or in another words, retun void, None, etc.)
  from a mutator method so that you cannot chain on a mutator method.
  Functional programming languages enough chaining on methods
  as they often have immutable objects and the methods return new objects
  rather than changing the original objects.</p>
</li>
<li>
<p>Python functions (except lambda functions) do not automatically return value
  unlike functional programming languages.
  Forgotting a <code>return</code> statement is a common mistake in Python.</p>
</li>
<li>
<p>According to <a href="https://docs.python.org/2/reference/expressions.html#operator-precedence">Python Operator Precedence</a>,
  the ternary expression <code>if - else</code> has a very low precedence. 
  However, it has higher precedence than the tuple operator <code>,</code>.
  It is suggested that you always use parentheses to make the precedence clear 
  when you use the ternary expression in a complicated expression.</p>
</li>
</ol>
<div class="highlight"><pre><span></span><span class="nv">update</span> <span class="o">=</span> {
    <span class="s1">&#39;</span><span class="s">status</span><span class="s1">&#39;</span>: <span class="s1">&#39;</span><span class="s">succeed</span><span class="s1">&#39;</span>, 
    <span class="s1">&#39;</span><span class="s">partitions</span><span class="s1">&#39;</span>: <span class="mi">52</span>,
    <span class="s1">&#39;</span><span class="s">size</span><span class="s1">&#39;</span>: <span class="mi">28836</span>,
    <span class="s1">&#39;</span><span class="s">end_time</span><span class="s1">&#39;</span>: <span class="mi">1563259850</span>.<span class="mi">937318</span>
}
[<span class="nv">key</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="s"> = </span><span class="s1">&#39;</span> <span class="o">+</span> <span class="nv">f</span><span class="s1">&#39;</span><span class="s">{val}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">val</span>, <span class="ss">(</span><span class="nv">int</span>, <span class="nv">float</span><span class="ss">))</span> <span class="k">else</span> <span class="nv">f</span><span class="s2">&quot;</span><span class="s">&#39;{val}&#39;</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="nv">key</span>, <span class="nv">val</span> <span class="nv">in</span> <span class="nv">update</span>.<span class="nv">items</span><span class="ss">()</span>]
</pre></div>


<p>returns</p>
<div class="highlight"><pre><span></span><span class="p">[</span><span class="ss">&quot;&#39;succeed&#39;&quot;</span><span class="p">,</span> <span class="s1">&#39;partitions = 52&#39;</span><span class="p">,</span> <span class="s1">&#39;size = 28836&#39;</span><span class="p">,</span> <span class="s1">&#39;end_time = 1563259850.937318&#39;</span><span class="p">]</span>
</pre></div>


<p>The issue can be fixed by putting the ternary expression into parentheses or define a (lambda) function for the ternary expression.</p>
<div class="highlight"><pre><span></span>[<span class="nv">key</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="s"> = </span><span class="s1">&#39;</span> <span class="o">+</span> <span class="ss">(</span><span class="nv">f</span><span class="s1">&#39;</span><span class="s">{update[key]}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="nv">isinstance</span><span class="ss">(</span><span class="nv">update</span>[<span class="nv">key</span>], <span class="ss">(</span><span class="nv">int</span>, <span class="nv">float</span><span class="ss">))</span> <span class="k">else</span> <span class="nv">f</span><span class="s2">&quot;</span><span class="s">&#39;{update[key]}&#39;</span><span class="s2">&quot;</span><span class="ss">)</span> <span class="k">for</span> <span class="nv">key</span> <span class="nv">in</span> <span class="nv">update</span>]
</pre></div>


<ol>
<li>
<p>Backslash (<code>\</code>) cannot be used in a f-string (introduced in Python 3.6).
  There are multiple ways to resolve this issue.
  First, you can precompute things needed to avoid using <code>\</code> in a f-string.
  Second, you can use <code>chr(10)</code> (which returns the backslash) instead.</p>
</li>
<li>
<p>If you need trackback information when throwing an exception use <code>raise ExceptionClass(msg)</code>,
  otherwise, use <code>sys.exit(msg)</code> instead.</p>
</li>
<li>
<p>You cannot use <code>return</code> to return result from a generator function.
  Instead a <code>return</code> behaves like raising a StopIteration.
  Please see this <a href="https://stackoverflow.com/questions/26595895/return-and-yield-in-the-same-function">issue</a>
  for more discussions.</p>
</li>
<li>
<p><code>max(some_iterable, default=0)</code></p>
</li>
<li>
<p><code>itertools.chain(iter1, iter2, ...)</code></p>
</li>
</ol>
<h2 id="referneces">Referneces</h2>
<ul>
<li>
<p><a href="http://www.toptal.com/python/top-10-mistakes-that-python-programmers-make">Common Mistakes</a></p>
</li>
<li>
<p><a href="https://stackoverflow.com/questions/1132941/least-astonishment-and-the-mutable-default-argument">Least Astonishment and The Mutble Default Argument</a></p>
</li>
</ul></div>
    <footer>
<p class="meta">
  <span class="byline author vcard">
    Posted by <span class="fn">Benjamin Du</span>
  </span>
<time datetime="2019-10-16T22:07:28-07:00" pubdate>Oct 16, 2019</time>  <span class="categories">
    <a class="category" href="http://www.legendu.net/misc/tag/programming.html">programming</a>
    <a class="category" href="http://www.legendu.net/misc/tag/python.html">Python</a>
    <a class="category" href="http://www.legendu.net/misc/tag/tricks.html">tricks</a>
    <a class="category" href="http://www.legendu.net/misc/tag/traps.html">traps</a>
    <a class="category" href="http://www.legendu.net/misc/tag/tips.html">tips</a>
  </span>
</p>    </footer>
  </article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div>
  </section>
</div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="http://www.legendu.net/misc/blog/python-tips/">Tips on Python</a>
      </li>
      <li class="post">
          <a href="http://www.legendu.net/misc/blog/python-tips-and-traps/">Python Tips and Traps</a>
      </li>
      <li class="post">
          <a href="http://www.legendu.net/misc/blog/exception-and-error-handling-in-python/">Exception and Error Handling in Python</a>
      </li>
      <li class="post">
          <a href="http://www.legendu.net/misc/blog/ipython-tips/">Tips on IPython</a>
      </li>
      <li class="post">
          <a href="http://www.legendu.net/misc/blog/tips-for-git-large-file-storage/">Tips for Git Large File Storage</a>
      </li>
    </ul>
  </section>
  <section>
      
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="http://www.legendu.net/misc/category/ai.html">AI</a></li>
        <li><a href="http://www.legendu.net/misc/category/career.html">Career</a></li>
        <li><a href="http://www.legendu.net/misc/category/cloud.html">Cloud</a></li>
        <li><a href="http://www.legendu.net/misc/category/database.html">Database</a></li>
        <li><a href="http://www.legendu.net/misc/category/encryption.html">Encryption</a></li>
        <li><a href="http://www.legendu.net/misc/category/english.html">English</a></li>
        <li><a href="http://www.legendu.net/misc/category/finance.html">Finance</a></li>
        <li><a href="http://www.legendu.net/misc/category/fun-problems.html">Fun Problems</a></li>
        <li><a href="http://www.legendu.net/misc/category/hardware.html">Hardware</a></li>
        <li><a href="http://www.legendu.net/misc/category/internet.html">Internet</a></li>
        <li><a href="http://www.legendu.net/misc/category/job.html">Job</a></li>
        <li><a href="http://www.legendu.net/misc/category/jupyterlab.html">JupyterLab</a></li>
        <li><a href="http://www.legendu.net/misc/category/language.html">Language</a></li>
        <li><a href="http://www.legendu.net/misc/category/life.html">Life</a></li>
        <li><a href="http://www.legendu.net/misc/category/links.html">Links</a></li>
        <li><a href="http://www.legendu.net/misc/category/linux.html">Linux</a></li>
        <li><a href="http://www.legendu.net/misc/category/machine-learning.html">Machine Learning</a></li>
        <li><a href="http://www.legendu.net/misc/category/macos.html">macOS</a></li>
        <li><a href="http://www.legendu.net/misc/category/network.html">Network</a></li>
        <li><a href="http://www.legendu.net/misc/category/os.html">OS</a></li>
        <li><a href="http://www.legendu.net/misc/category/people.html">People</a></li>
        <li><a href="http://www.legendu.net/misc/category/philosophy.html">Philosophy</a></li>
        <li><a href="http://www.legendu.net/misc/category/programming.html">Programming</a></li>
        <li><a href="http://www.legendu.net/misc/category/research.html">Research</a></li>
        <li><a href="http://www.legendu.net/misc/category/sheng-huo.html">生活</a></li>
        <li><a href="http://www.legendu.net/misc/category/si-suo.html">思索</a></li>
        <li><a href="http://www.legendu.net/misc/category/software.html">Software</a></li>
        <li><a href="http://www.legendu.net/misc/category/statistics.html">Statistics</a></li>
        <li><a href="http://www.legendu.net/misc/category/teleconference.html">Teleconference</a></li>
        <li><a href="http://www.legendu.net/misc/category/tools.html">Tools</a></li>
        <li><a href="http://www.legendu.net/misc/category/trading.html">Trading</a></li>
        <li><a href="http://www.legendu.net/misc/category/unix.html">Unix</a></li>
        <li><a href="http://www.legendu.net/misc/category/visualization.html">Visualization</a></li>
        <li><a href="http://www.legendu.net/misc/category/windows.html">Windows</a></li>
        <li><a href="http://www.legendu.net/misc/category/work.html">Work</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
  <p class="tagcloud">
  </p>
  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/dclong">@dclong</a> on GitHub
    <script type="text/javascript">
      $.domReady(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'http://www.legendu.net/misc/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'dclong',
              count: 3,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="http://www.legendu.net/misc/theme/js/github.js" type="text/javascript"> </script>
  </section>

    <section>
        <h1>Social</h2>
        <ul>
            <li><a href="https://www.linkedin.com/in/ben-chuanlong-du-1239b221/" target="_blank">LinkedIn</a></li>
            <li><a href="https://twitter.com/longendu" target="_blank">Twitter</a></li>
            <li><a href="https://www.facebook.com/chuanlong.du" target="_blank">Facebook</a></li>
        <!--
            <li><a href="http://www.legendu.net/misc/" type="application/rss+xml" rel="alternate">RSS</a></li>
            -->
        </ul>
    </section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Ben Chuanlong Du -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-30259661-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
	<script type="text/javascript">
	  var disqus_shortname = 'dclong';
          var disqus_identifier = '/blog/python-tips-and-traps/';
          var disqus_url = 'http://www.legendu.net/misc/blog/python-tips-and-traps/';
          var disqus_title = 'Python Tips and Traps';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
</body>
</html>