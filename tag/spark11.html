<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Ben Chuanlong Du's Blog - Spark</title>
  <meta name="author" content="Ben Chuanlong Du">

  <link href="https://misc.legendu.net/atom.xml" type="application/atom+xml" rel="alternate"
        title="Ben Chuanlong Du's Blog Atom Feed" />


  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://misc.legendu.net/favicon.png" rel="icon">
  <link href="https://misc.legendu.net/theme/css/main_2.css" media="screen, projection"
        rel="stylesheet" type="text/css">
  <script src="https://misc.legendu.net/theme/js/modernizr-2.0.js"></script>
  <script src="https://misc.legendu.net/theme/js/ender.js"></script>
  <script src="https://misc.legendu.net/theme/js/octopress.js" type="text/javascript"></script>

  <link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic"
        rel="stylesheet" type="text/css">
  <script data-ad-client="ca-pub-3836424032203369" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
</head>

<body>
  <header role="banner"><hgroup>
  <h1><a href="https://misc.legendu.net/">Ben Chuanlong Du's Blog</a></h1>
    <h2>It is never too late to learn.</h2>
</hgroup></header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="https://misc.legendu.net/atom.xml" rel="subscribe-rss">RSS</a></li>
</ul>

<form name="search" action="https://www.bing.com/search" method="get" onSubmit="return build_query()">
  <fieldset role="search">
      <!--
    <input type="hidden" name="q" value="site:https://misc.legendu.net" />
        -->
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>

<script type = "text/javascript">
    function build_query() {
        var query = document.forms["search"]["q"].value;
        var prefix = "site:https://misc.legendu.net "
        if (!query.startsWith(prefix)) {
            query = prefix + query;
            document.forms["search"]["q"].value = query;
        }
        return true;
    }
</script>

<ul class="main-navigation">
    <li><a href="https://www.legendu.net">Home</a></li>
    <li><a href="https://misc.legendu.net">Blog</a></li>
    <li><a href="https://misc.legendu.net/archives.html">Archives</a></li>
    <li><a href="https://misc.legendu.net/categories.html">Categories</a></li>
    <li><a href="https://misc.legendu.net/tags.html">Tags</a></li>
    <li><a href="https://www.legendu.net/pages/about">About</a></li>
</ul></nav>
  <div id="main">
    <div id="content">
<div class="blog-index">
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://misc.legendu.net/blog/spark-issues-total-size-bigger-than-maxresultsize/">Spark Issue: Total Size of Serialized Results Is Bigger than spark.driver.maxResultSize</a>
      </h1>
      <p class="meta"><time datetime="2019-02-21T12:14:37-08:00" pubdate>Feb 21, 2019</time></p>
</header>

  <div class="entry-content"><p><strong>Things on this page are fragmentary and immature notes/thoughts of the author. Please read with your own judgement!</strong></p>
<h2 id="issue">Issue</h2>
<p>Total size of serialized results is bigger than spark.driver.maxResultSize</p>
<h2 id="solutions">Solutions</h2>
<ol>
<li>
<p>Eliminate unnecessary <code>broadcast</code> or <code>collect</code>.</p>
</li>
<li>
<p>If one of the tables for joining contains too large number of partitions …</p></li></ol></div>
  <footer>
    <a rel="full-article" href="https://misc.legendu.net/blog/spark-issues-total-size-bigger-than-maxresultsize/">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://misc.legendu.net/blog/spark-unable-to-find-encoder-type-issue/">Spark Issue: Unable to Find Encoder Type</a>
      </h1>
      <p class="meta"><time datetime="2019-05-21T12:14:37-07:00" pubdate>May 21, 2019</time></p>
</header>

  <div class="entry-content"><p><strong>Things on this page are fragmentary and immature notes/thoughts of the author. Please read with your own judgement!</strong></p>
<p><strong>Things on this page are fragmentary and immature notes/thoughts of the author. Please read with your own judgement!</strong></p>
<h2 id="issue-unable-to-find-encoder-for-type-stored-in-a-dataset">Issue Unable to find encoder for type stored in a Dataset</h2>
<h2 id="solution">Solution …</h2></div>
  <footer>
    <a rel="full-article" href="https://misc.legendu.net/blog/spark-unable-to-find-encoder-type-issue/">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://misc.legendu.net/blog/select-all-columns-except-a-few-from-a-table/">Select All Columns Except a Few from a Table</a>
      </h1>
      <p class="meta"><time datetime="2021-01-10T13:04:59-08:00" pubdate>Jan 10, 2021</time></p>
</header>

  <div class="entry-content"><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong> Things on this page are fragmentary and immature notes/thoughts of the author. Please read with your own judgement! </strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Comments">Comments<a class="anchor-link" href="#Comments">&#182;</a></h2><p>There is no (direct) way of select all columns except a few from a table using SQL.
However, 
this is easily doable with DataFrame APIs (pandas, Spark/PySpark, etc.).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input"></div>
  <footer>
    <a rel="full-article" href="https://misc.legendu.net/blog/select-all-columns-except-a-few-from-a-table/">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://misc.legendu.net/blog/get-size-of-tables-on-hdfs/">Get Size of Tables on HDFS</a>
      </h1>
      <p class="meta"><time datetime="2020-11-10T12:41:56-08:00" pubdate>Nov 10, 2020</time></p>
</header>

  <div class="entry-content"><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong> Things on this page are fragmentary and immature notes/thoughts of the author. Please read with your own judgement! </strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-HDFS-Way">The HDFS Way<a class="anchor-link" href="#The-HDFS-Way">&#182;</a></h2><p>You can use the <code>hdfs dfs -du /path/to/table</code> command 
or <code>hdfs dfs -count -q -v -h /path/to/table</code>
to get the size of an HDFS path (or table). 
However, 
this only works if the cluster supports HDFS. 
If a Spark cluster exposes only JDBC/ODBC APIs, 
this method does not work.</p></div>
  <footer>
    <a rel="full-article" href="https://misc.legendu.net/blog/get-size-of-tables-on-hdfs/">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://misc.legendu.net/blog/access-control-in-spark-sql/">Access Control in Spark SQL</a>
      </h1>
      <p class="meta"><time datetime="2020-07-22T10:11:21-07:00" pubdate>Jul 22, 2020</time></p>
</header>

  <div class="entry-content"><p><strong>Things on this page are fragmentary and immature notes/thoughts of the author. Please read with your own judgement!</strong></p>
<h2 id="grant-permission-to-users">Grant Permission to Users</h2>
<div class="highlight"><pre><span></span><code><span class="nx">GRANT</span>
<span class="w">    </span><span class="nx">priv_type</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="nx">priv_type</span><span class="w"> </span><span class="p">]</span><span class="w"> </span><span class="o">...</span>
<span class="w">    </span><span class="nx">ON</span><span class="w"> </span><span class="nx">database_table_or_view_name</span>
<span class="w">    </span><span class="nx">TO</span><span class="w"> </span><span class="nx">principal_specification</span><span class="w"> </span><span class="p">[,</span><span class="w"> </span><span class="nx">principal_specification</span><span class="p">]</span><span class="w"> </span><span class="o">...</span>
<span class="w">    </span><span class="p">[</span><span class="nx">WITH</span><span class="w"> </span><span class="nx">GRANT</span><span class="w"> </span><span class="nx">OPTION</span><span class="p">];</span>
</code></pre></div>

<p>Examples:</p>
<div class="highlight"><pre><span></span><code>GRANT SELECT ON table1 TO USER user1;
GRANT SELECT ON DATABASE db1 TO USER user1 …</code></pre></div></div>
  <footer>
    <a rel="full-article" href="https://misc.legendu.net/blog/access-control-in-spark-sql/">Read On &crarr;</a>
  </footer>
  		</article>
  		<article>
<header>
      <h1 class="entry-title">
        <a href="https://misc.legendu.net/blog/spark-io/">Read/Write Files/Tables in Spark</a>
      </h1>
      <p class="meta"><time datetime="2020-09-27T23:00:01-07:00" pubdate>Sep 27, 2020</time></p>
</header>

  <div class="entry-content"><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="References">References<a class="anchor-link" href="#References">&#182;</a></h2><p><a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.DataFrameReader">DataFrameReader</a> 
APIs</p>
<p><a href="https://spark.apache.org/docs/latest/api/scala/index.html#org.apache.spark.sql.DataFrameWriter">DataFrameWriter</a>
APIs</p>
<p><a href="https://spark.apache.org/docs/latest/sql-programming-guide.html#data-sources">https://spark.apache.org/docs/latest/sql-programming-guide.html#data-sources</a></p>
<h2 id="Comments">Comments<a class="anchor-link" href="#Comments">&#182;</a></h2><ol>
<li><p>It is suggested that you 
 <a href="https://stackoverflow.com/questions/39926411/provide-schema-while-reading-csv-file-as-a-dataframe">specify a schema when reading text files</a>.
 If a schema is not specified when reading text files,
 it is good practice to check the types of columns (as the types are inferred).</p>
</li>
<li><p>Do NOT read data from and write data to the same path in Spark!
 Due to lazy evaluation of Spark, 
 the path will likely be cleared before it is read into Spark,
 which will throw IO exceptions.
 And the worst part is that your data on HDFS is removed but recoverable.</p></div>
  <footer>
    <a rel="full-article" href="https://misc.legendu.net/blog/spark-io/">Read On &crarr;</a>
  </footer>
  		</article>
<div class="pagination">
    <a class="prev" href="https://misc.legendu.net/tag/spark12.html">&larr; Older</a>

      <a class="next" href="https://misc.legendu.net/tag/spark10.html">Newer &rarr;</a>
  <br />
</div></div>
<aside class="sidebar">
  <section>
    <h1>Recent Posts</h1>
    <ul id="recent_posts">
      <li class="post">
          <a href="https://misc.legendu.net/blog/Use-tablesample-in-sql/">Use TableSample in SQL</a>
      </li>
      <li class="post">
          <a href="https://misc.legendu.net/blog/improve-spark-performance/">Improve the Performance of Spark</a>
      </li>
      <li class="post">
          <a href="https://misc.legendu.net/blog/spark-issue:-IllegalArgumentException:-Wrong-FS/">Spark Issue: IllegalArgumentException: Wrong FS</a>
      </li>
      <li class="post">
          <a href="https://misc.legendu.net/blog/spark-issue:-ViewFs:-Cannot-initialize:-Empty-Mount-table-in-config/">Spark Issue: ViewFs: Cannot Initialize: Empty Mount Table in Config</a>
      </li>
      <li class="post">
          <a href="https://misc.legendu.net/blog/spark-issue:-ArrowTypeError:-Expect-a-type-but-got-a-different-type/">Spark Issue: ArrowTypeError: Expect a Type but Got a Different Type</a>
      </li>
    </ul>
  </section>
  <section>
    <h1>Categories</h1>
    <ul id="recent_posts">
        <li><a href="https://misc.legendu.net/category/ai.html">AI</a></li>
        <li><a href="https://misc.legendu.net/category/career.html">Career</a></li>
        <li><a href="https://misc.legendu.net/category/cloud.html">Cloud</a></li>
        <li><a href="https://misc.legendu.net/category/computer-science.html">Computer Science</a></li>
        <li><a href="https://misc.legendu.net/category/fiannce.html">Fiannce</a></li>
        <li><a href="https://misc.legendu.net/category/finance.html">Finance</a></li>
        <li><a href="https://misc.legendu.net/category/fun-problems.html">Fun Problems</a></li>
        <li><a href="https://misc.legendu.net/category/hardware.html">Hardware</a></li>
        <li><a href="https://misc.legendu.net/category/health.html">Health</a></li>
        <li><a href="https://misc.legendu.net/category/house.html">House</a></li>
        <li><a href="https://misc.legendu.net/category/internet.html">Internet</a></li>
        <li><a href="https://misc.legendu.net/category/investment.html">Investment</a></li>
        <li><a href="https://misc.legendu.net/category/life.html">life</a></li>
        <li><a href="https://misc.legendu.net/category/linux.html">Linux</a></li>
        <li><a href="https://misc.legendu.net/category/os.html">OS</a></li>
        <li><a href="https://misc.legendu.net/category/people.html">People</a></li>
        <li><a href="https://misc.legendu.net/category/philosophy.html">Philosophy</a></li>
        <li><a href="https://misc.legendu.net/category/research.html">Research</a></li>
        <li><a href="https://misc.legendu.net/category/shopping.html">Shopping</a></li>
        <li><a href="https://misc.legendu.net/category/soft-skills.html">soft skills</a></li>
        <li><a href="https://misc.legendu.net/category/software.html">Software</a></li>
        <li><a href="https://misc.legendu.net/category/statistics.html">Statistics</a></li>
        <li><a href="https://misc.legendu.net/category/tools.html">Tools</a></li>
    </ul>
  </section>
 

  <section>
  <h1>Tags</h1>
  <ul class="tagcloud">
  </ul>
  </section>



  <section>
    <h1>GitHub Repos</h1>
    <ul id="gh_repos">
      <li class="loading">Status updating...</li>
    </ul>
      <a href="https://github.com/legendu-net">@legendu-net</a> on GitHub
    <script type="text/javascript">
      $.domReady(function(){
          if (!window.jXHR){
              var jxhr = document.createElement('script');
              jxhr.type = 'text/javascript';
              jxhr.src = 'https://misc.legendu.net/theme/js/jXHR.js';
              var s = document.getElementsByTagName('script')[0];
              s.parentNode.insertBefore(jxhr, s);
          }

          github.showRepos({
              user: 'legendu-net',
              count: 5,
              skip_forks: true,
              target: '#gh_repos'
          });
      });
    </script>
    <script src="https://misc.legendu.net/theme/js/github.js" type="text/javascript"> </script>
  </section>

    <section>
        <h1>Social</h2>
        <ul>
            <li><a href="https://www.linkedin.com/in/ben-chuanlong-du-1239b221/" target="_blank">LinkedIn</a></li>
            <li><a href="https://hub.docker.com/u/dclong" target="_blank">Docker Hub</a></li>
            <li><a href="https://stackoverflow.com/users/7808204/benjamin-du?tab=profile" target="_blank">Stack Overflow</a></li>
            <li><a href="https://twitter.com/longendu" target="_blank">Twitter</a></li>
        <!--
            <li><a href="https://misc.legendu.net/" type="application/rss+xml" rel="alternate">RSS</a></li>
            -->
        </ul>
    </section>
</aside>    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - Ben Chuanlong Du -
  <span class="credit">Powered by <a href="http://getpelican.com">Pelican</a></span>
</p></footer>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-3STS9BVPF6"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-3STS9BVPF6');
</script>
	<script type="text/javascript">
	  var disqus_shortname = 'dclong';
	  (function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	   })();
	</script>
</body>
</html>